CREATE TABLE DEPARTMENT (DNO VARCHAR(10) PRIMARY KEY,DNAME VARCHAR(20),MGRSTARTDATE DATE);

CREATE TABLE EMPLOYEE (SSN VARCHAR(10) PRIMARY KEY,SUPERSSN VARCHAR(10),DNO VARCHAR(10),FNAME VARCHAR(8),LNAME VARCHAR(8),ADDRESS VARCHAR(10),SEX CHAR(1),SALARY DECIMAL(10, 2),FOREIGN KEY (SUPERSSN) REFERENCES EMPLOYEE (SSN),FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO));

ALTER TABLE DEPARTMENT ADD MGRSSN VARCHAR(10) references employee(SSN);

CREATE TABLE DLOCATION (DNO VARCHAR(10),DLOC VARCHAR(10),PRIMARY KEY (DNO, DLOC),FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO));

CREATE TABLE PROJECT (PNO INT PRIMARY KEY,DNO VARCHAR(10),PNAME VARCHAR(20),PLOCATION VARCHAR(20),FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO));

CREATE TABLE WORKS_ON (HOURS INT,SSN VARCHAR(10),PNO INT,PRIMARY KEY (SSN, PNO),FOREIGN KEY (SSN) REFERENCES EMPLOYEE (SSN),FOREIGN KEY (PNO) REFERENCES PROJECT (PNO));


/* 1. Make a list of all project numbers for projects that involve an employee whose last
name is 'Scott', either as a worker or as a manager of the department that controls the
project. */

	SELECT DISTINCT P.PNO
	FROM PROJECT P, DEPARTMENT D, EMPLOYEE E
	WHERE P.DNO=D.DNO AND 
		D.MGRSSN=E.SSN AND
		E.LNAME='SCOTT'
UNION
	SELECT DISTINCT W.PNO
	FROM WORKS_ON W, EMPLOYEE E1
	WHERE	E1.SSN=W.SSN AND
		E1.LNAME='SCOTT';


/* 2. Show the resulting salaries if every employee working on the 'IoT’ project is given a 10
percent raise. */

SELECT E.FNAME, E.LNAME, 1.1*E.SALARY AS INCR_SAL
FROM EMPLOYEE E, WORKS_ON W, PROJECT P
WHERE E.SSN=W.SSN AND
	W.PNO=P.PNO AND
	P.PNAME='IOT';

/* 3. Find the sum of the salaries of all employees of the 'Accounts’ department, as well as
the maximum salary, the minimum salary, and the average salary in this department. */

SELECT SUM (E.SALARY), MAX (E.SALARY), MIN (E.SALARY), AVG (E.SALARY)
FROM EMPLOYEE E, DEPARTMENT D
WHERE E.DNO=D.DNO AND
	D.DNAME='ACCOUNTS';

/* 4. Retrieve the name of each employee who works on all the projects Controlled by
department number 5 (use NOT EXISTS operator). */

SELECT E.FNAME, E.LNAME
FROM EMPLOYEE E
WHERE NOT EXISTS(
		(SELECT PNO FROM PROJECT WHERE DNO=5) 
		MINUS
		(SELECT PNO FROM WORKS_ON WHERE E.SSN=SSN)
	);


/* 5. For each department that has more than five employees, retrieve the department
number and the number of its employees who are making more than Rs. 6,00,000. */

SELECT E.DNO, COUNT (E.SSN) as "No. oF Employees"
FROM EMPLOYEE E
WHERE	E.SALARY > 600000 AND
	E.DNO IN (SELECT E1.DNO
		  FROM EMPLOYEE E1
		  GROUP BY E1.DNO
		  HAVING COUNT (E1.DNO) > 5 )
GROUP BY E.DNO;


INSERT INTO employee (SSN, SUPERSSN, DNO, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES
('RNSACC01', 'RNSACC02', '1', 'AHANA', 'K', '123 Main St', 'F', 400000.00),
('RNSACC02', NULL, '1', 'SANTHOSH', 'KUMAR', '456 Elm St', 'M', 320000.00),
('RNSCSE01', 'RNSCSE02', '5', 'JAMES', 'SMITH', '789 Oak St', 'M', 520000.00),
('RNSCSE02', 'RNSCSE03', '5', 'HEARN', 'BAKER', '101 Pine St', 'M', 720000.00),
('RNSCSE03', 'RNSCSE04', '5', 'EDWARD', 'SCOTT', '202 Maple St', 'M', 520000.00),
('RNSCSE04', 'RNSCSE05', '5', 'PAVAN', 'HEGDE', '303 Elm St', 'M', 670000.00),
('RNSCSE05', 'RNSCSE06', '5', 'GIRISH', 'MALYA', '404 Oak St', 'M', 480000.00),
('RNSCSE06', NULL, '5', 'NEHA', 'SN', '505 Pine St', 'F', 820000.00),
('RNSECE01', NULL, '3', 'JOHN', 'SCOTT', '606 Maple St', 'M', 470000.00),
('RNSISE01', NULL, '4', 'VEENA', 'M', '707 Main St', 'M', 620000.00),
('RNSIT01', NULL, '2', 'NAGESH', 'HR', '808 Elm St', 'M', 550000.00);











PROG 4


CREATE TABLE STUDENT (USN VARCHAR(10) PRIMARY KEY, SNAME VARCHAR(25), ADDRESS VARCHAR(25), PHONE VARCHAR(10), GENDER CHAR(1)); 

CREATE TABLE SEMSEC (SSID VARCHAR(5) PRIMARY KEY, SEM INT(2), SEC CHAR(1)); 

CREATE TABLE CLASS (USN VARCHAR(10), SSID VARCHAR(5), PRIMARY KEY(USN,SSID), FOREIGN KEY(USN) REFERENCES STUDENT(USN), FOREIGN KEY(SSID) REFERENCES SEMSEC(SSID)); 

CREATE TABLE SUBJECT (SUBCODE VARCHAR(8) PRIMARY KEY, TITLE VARCHAR(20), SEM INT(2), CREDITS INT(2)); 

CREATE TABLE IAMARKS (USN VARCHAR(10), SUBCODE VARCHAR(8), SSID VARCHAR(5), TEST1 INT(2), TEST2 INT(2), TEST3 INT(2), FINALIA INT(3), PRIMARY KEY(USN,SUBCODE,SSID), FOREIGN KEY(USN) REFERENCES STUDENT(USN), FOREIGN KEY(SUBCODE) REFERENCES SUBJECT(SUBCODE), FOREIGN KEY(SSID) REFERENCES SEMSEC(SSID));

select s.usn,sname,address,phone,gender from student s, class c, semsec ss where sem=4 and sec='c' and ss.ssid=c.ssid and c.usn=s.usn;

SELECT SEM,SEC,GENDER,COUNT(*) FROM STUDENT S, SEMSEC SS,CLASS C WHERE S.USN=C.USN AND C.SSID=SS.SSID GROUP BY SEM,SEC,GENDER ORDER BY SEM;

CREATE VIEW TEST1 AS SELECT SUBCODE, TEST1 FROM IAMARKS WHERE USN='1cg15ee065';

SELECT S.USN, S.SNAME, S.ADDRESS, S.PHONE, S.GENDER, CASE WHEN IA.FINALIA BETWEEN 17 AND 20 THEN 'OUTSTANDING' WHEN IA.FINALIA BETWEEN 12 AND 16 THEN 'AVERAGE' ELSE 'WEAK' END AS CAT FROM STUDENT S, SEMSEC SS, IAMARKS IA, SUBJECT SUB WHERE S.USN = IA.USN AND SS.SSID = IA.SSID AND SUB.SUBCODE = IA.SUBCODE AND SUB.SEM = 7;

